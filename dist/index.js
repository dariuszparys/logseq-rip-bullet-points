(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const q of document.querySelectorAll('link[rel="modulepreload"]'))Z(q);new MutationObserver(q=>{for(const Q of q)if(Q.type==="childList")for(const N of Q.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&Z(N)}).observe(document,{childList:!0,subtree:!0});function At(q){const Q={};return q.integrity&&(Q.integrity=q.integrity),q.referrerPolicy&&(Q.referrerPolicy=q.referrerPolicy),q.crossOrigin==="use-credentials"?Q.credentials="include":q.crossOrigin==="anonymous"?Q.credentials="omit":Q.credentials="same-origin",Q}function Z(q){if(q.ep)return;q.ep=!0;const Q=At(q);fetch(q.href,Q)}})();var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */_n.exports;(function(K,D){(function(At,Z){K.exports=Z()})(self,()=>(()=>{var At={227:(N,u,j)=>{var L=j(155);u.formatArgs=function(P){if(P[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+P[0]+(this.useColors?"%c ":" ")+"+"+N.exports.humanize(this.diff),!this.useColors)return;const Y="color: "+this.color;P.splice(1,0,Y,"color: inherit");let v=0,h=0;P[0].replace(/%[a-zA-Z%]/g,_=>{_!=="%%"&&(v++,_==="%c"&&(h=v))}),P.splice(h,0,Y)},u.save=function(P){try{P?u.storage.setItem("debug",P):u.storage.removeItem("debug")}catch{}},u.load=function(){let P;try{P=u.storage.getItem("debug")}catch{}return!P&&L!==void 0&&"env"in L&&(P=L.env.DEBUG),P},u.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},u.storage=function(){try{return localStorage}catch{}}(),u.destroy=(()=>{let P=!1;return()=>{P||(P=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],u.log=console.debug||console.log||(()=>{}),N.exports=j(447)(u);const{formatters:A}=N.exports;A.j=function(P){try{return JSON.stringify(P)}catch(Y){return"[UnexpectedJSONParseError]: "+Y.message}}},447:(N,u,j)=>{N.exports=function(L){function A(v){let h,_,f,w=null;function y(...k){if(!y.enabled)return;const $=y,E=Number(new Date),T=E-(h||E);$.diff=T,$.prev=h,$.curr=E,h=E,k[0]=A.coerce(k[0]),typeof k[0]!="string"&&k.unshift("%O");let i=0;k[0]=k[0].replace(/%([a-zA-Z%])/g,(l,m)=>{if(l==="%%")return"%";i++;const g=A.formatters[m];if(typeof g=="function"){const W=k[i];l=g.call($,W),k.splice(i,1),i--}return l}),A.formatArgs.call($,k),($.log||A.log).apply($,k)}return y.namespace=v,y.useColors=A.useColors(),y.color=A.selectColor(v),y.extend=P,y.destroy=A.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>w!==null?w:(_!==A.namespaces&&(_=A.namespaces,f=A.enabled(v)),f),set:k=>{w=k}}),typeof A.init=="function"&&A.init(y),y}function P(v,h){const _=A(this.namespace+(h===void 0?":":h)+v);return _.log=this.log,_}function Y(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}return A.debug=A,A.default=A,A.coerce=function(v){return v instanceof Error?v.stack||v.message:v},A.disable=function(){const v=[...A.names.map(Y),...A.skips.map(Y).map(h=>"-"+h)].join(",");return A.enable(""),v},A.enable=function(v){let h;A.save(v),A.namespaces=v,A.names=[],A.skips=[];const _=(typeof v=="string"?v:"").split(/[\s,]+/),f=_.length;for(h=0;h<f;h++)_[h]&&((v=_[h].replace(/\*/g,".*?"))[0]==="-"?A.skips.push(new RegExp("^"+v.slice(1)+"$")):A.names.push(new RegExp("^"+v+"$")))},A.enabled=function(v){if(v[v.length-1]==="*")return!0;let h,_;for(h=0,_=A.skips.length;h<_;h++)if(A.skips[h].test(v))return!1;for(h=0,_=A.names.length;h<_;h++)if(A.names[h].test(v))return!0;return!1},A.humanize=j(824),A.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(L).forEach(v=>{A[v]=L[v]}),A.names=[],A.skips=[],A.formatters={},A.selectColor=function(v){let h=0;for(let _=0;_<v.length;_++)h=(h<<5)-h+v.charCodeAt(_),h|=0;return A.colors[Math.abs(h)%A.colors.length]},A.enable(A.load()),A}},996:N=>{var u=function(f){return function(w){return!!w&&typeof w=="object"}(f)&&!function(w){var y=Object.prototype.toString.call(w);return y==="[object RegExp]"||y==="[object Date]"||function(k){return k.$$typeof===j}(w)}(f)},j=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function L(f,w){return w.clone!==!1&&w.isMergeableObject(f)?h((y=f,Array.isArray(y)?[]:{}),f,w):f;var y}function A(f,w,y){return f.concat(w).map(function(k){return L(k,y)})}function P(f){return Object.keys(f).concat(function(w){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(w).filter(function(y){return Object.propertyIsEnumerable.call(w,y)}):[]}(f))}function Y(f,w){try{return w in f}catch{return!1}}function v(f,w,y){var k={};return y.isMergeableObject(f)&&P(f).forEach(function($){k[$]=L(f[$],y)}),P(w).forEach(function($){(function(E,T){return Y(E,T)&&!(Object.hasOwnProperty.call(E,T)&&Object.propertyIsEnumerable.call(E,T))})(f,$)||(Y(f,$)&&y.isMergeableObject(w[$])?k[$]=function(E,T){if(!T.customMerge)return h;var i=T.customMerge(E);return typeof i=="function"?i:h}($,y)(f[$],w[$],y):k[$]=L(w[$],y))}),k}function h(f,w,y){(y=y||{}).arrayMerge=y.arrayMerge||A,y.isMergeableObject=y.isMergeableObject||u,y.cloneUnlessOtherwiseSpecified=L;var k=Array.isArray(w);return k===Array.isArray(f)?k?y.arrayMerge(f,w,y):v(f,w,y):L(w,y)}h.all=function(f,w){if(!Array.isArray(f))throw new Error("first argument should be an array");return f.reduce(function(y,k){return h(y,k,w)},{})};var _=h;N.exports=_},856:function(N){N.exports=function(){function u(C){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},u(C)}function j(C,I){return j=Object.setPrototypeOf||function(H,V){return H.__proto__=V,H},j(C,I)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(C,I,H){return A=L()?Reflect.construct:function(V,ht,Rt){var Wt=[null];Wt.push.apply(Wt,ht);var ee=new(Function.bind.apply(V,Wt));return Rt&&j(ee,Rt.prototype),ee},A.apply(null,arguments)}function P(C){return Y(C)||v(C)||h(C)||f()}function Y(C){if(Array.isArray(C))return _(C)}function v(C){if(typeof Symbol<"u"&&C[Symbol.iterator]!=null||C["@@iterator"]!=null)return Array.from(C)}function h(C,I){if(C){if(typeof C=="string")return _(C,I);var H=Object.prototype.toString.call(C).slice(8,-1);return H==="Object"&&C.constructor&&(H=C.constructor.name),H==="Map"||H==="Set"?Array.from(C):H==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(H)?_(C,I):void 0}}function _(C,I){(I==null||I>C.length)&&(I=C.length);for(var H=0,V=new Array(I);H<I;H++)V[H]=C[H];return V}function f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var w=Object.hasOwnProperty,y=Object.setPrototypeOf,k=Object.isFrozen,$=Object.getPrototypeOf,E=Object.getOwnPropertyDescriptor,T=Object.freeze,i=Object.seal,l=Object.create,m=typeof Reflect<"u"&&Reflect,g=m.apply,W=m.construct;g||(g=function(C,I,H){return C.apply(I,H)}),T||(T=function(C){return C}),i||(i=function(C){return C}),W||(W=function(C,I){return A(C,P(I))});var et=tt(Array.prototype.forEach),st=tt(Array.prototype.pop),pt=tt(Array.prototype.push),_t=tt(String.prototype.toLowerCase),xt=tt(String.prototype.match),vt=tt(String.prototype.replace),Se=tt(String.prototype.indexOf),p=tt(String.prototype.trim),b=tt(RegExp.prototype.test),U=Ct(TypeError);function tt(C){return function(I){for(var H=arguments.length,V=new Array(H>1?H-1:0),ht=1;ht<H;ht++)V[ht-1]=arguments[ht];return g(C,I,V)}}function Ct(C){return function(){for(var I=arguments.length,H=new Array(I),V=0;V<I;V++)H[V]=arguments[V];return W(C,H)}}function M(C,I){y&&y(C,null);for(var H=I.length;H--;){var V=I[H];if(typeof V=="string"){var ht=_t(V);ht!==V&&(k(I)||(I[H]=ht),V=ht)}C[V]=!0}return C}function J(C){var I,H=l(null);for(I in C)g(w,C,[I])&&(H[I]=C[I]);return H}function it(C,I){for(;C!==null;){var H=E(C,I);if(H){if(H.get)return tt(H.get);if(typeof H.value=="function")return tt(H.value)}C=$(C)}function V(ht){return console.warn("fallback value for",ht),null}return V}var jt=T(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),wt=T(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),It=T(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),te=T(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ut=T(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ct=T(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),St=T(["#text"]),Et=T(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Nt=T(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vt=T(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Lt=T(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),kt=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),pe=i(/<%[\w\W]*|[\w\W]*%>/gm),wn=i(/^data-[\-\w.\u00B7-\uFFFF]/),Pt=i(/^aria-[\-\w]+$/),Bt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ze=i(/^(?:\w+script|data):/i),xn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Cn=i(/^html$/i),he=function(){return typeof window>"u"?null:window},Sn=function(C,I){if(u(C)!=="object"||typeof C.createPolicy!="function")return null;var H=null,V="data-tt-policy-suffix";I.currentScript&&I.currentScript.hasAttribute(V)&&(H=I.currentScript.getAttribute(V));var ht="dompurify"+(H?"#"+H:"");try{return C.createPolicy(ht,{createHTML:function(Rt){return Rt}})}catch{return console.warn("TrustedTypes policy "+ht+" could not be created."),null}};function Ve(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he(),I=function(o){return Ve(o)};if(I.version="2.3.8",I.removed=[],!C||!C.document||C.document.nodeType!==9)return I.isSupported=!1,I;var H=C.document,V=C.document,ht=C.DocumentFragment,Rt=C.HTMLTemplateElement,Wt=C.Node,ee=C.Element,Ne=C.NodeFilter,Ke=C.NamedNodeMap,Kt=Ke===void 0?C.NamedNodeMap||C.MozNamedAttrMap:Ke,On=C.HTMLFormElement,An=C.DOMParser,jn=C.trustedTypes,Oe=ee.prototype,En=it(Oe,"cloneNode"),kn=it(Oe,"nextSibling"),Tn=it(Oe,"childNodes"),Pe=it(Oe,"parentNode");if(typeof Rt=="function"){var Dt=V.createElement("template");Dt.content&&Dt.content.ownerDocument&&(V=Dt.content.ownerDocument)}var $t=Sn(jn,H),Ye=$t?$t.createHTML(""):"",Ae=V,Re=Ae.implementation,ne=Ae.createNodeIterator,Qe=Ae.createDocumentFragment,Xe=Ae.getElementsByTagName,In=H.importNode,tn={};try{tn=J(V).documentMode?V.documentMode:{}}catch{}var Mt={};I.isSupported=typeof Pe=="function"&&Re&&Re.createHTMLDocument!==void 0&&tn!==9;var de,Gt,je=kt,Ee=pe,De=wn,Ln=Pt,en=Ze,ke=xn,nt=Bt,dt=null,nn=M({},[].concat(P(jt),P(wt),P(It),P(ut),P(St))),mt=null,re=M({},[].concat(P(Et),P(Nt),P(Vt),P(Lt))),lt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),oe=null,Te=null,$e=!0,Ue=!0,rn=!1,ie=!1,Yt=!1,ze=!1,He=!1,se=!1,Ie=!1,ae=!1,on=!0,qe=!0,ce=!1,Ut={},le=null,sn=M({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),an=null,cn=M({},["audio","video","img","source","image","track"]),Be=null,Qt=M({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ue="http://www.w3.org/1998/Math/MathML",We="http://www.w3.org/2000/svg",Jt="http://www.w3.org/1999/xhtml",Le=Jt,ln=!1,me=["application/xhtml+xml","text/html"],ge="text/html",fe=null,Mn=V.createElement("form"),un=function(o){return o instanceof RegExp||o instanceof Function},Ge=function(o){fe&&fe===o||(o&&u(o)==="object"||(o={}),o=J(o),dt="ALLOWED_TAGS"in o?M({},o.ALLOWED_TAGS):nn,mt="ALLOWED_ATTR"in o?M({},o.ALLOWED_ATTR):re,Be="ADD_URI_SAFE_ATTR"in o?M(J(Qt),o.ADD_URI_SAFE_ATTR):Qt,an="ADD_DATA_URI_TAGS"in o?M(J(cn),o.ADD_DATA_URI_TAGS):cn,le="FORBID_CONTENTS"in o?M({},o.FORBID_CONTENTS):sn,oe="FORBID_TAGS"in o?M({},o.FORBID_TAGS):{},Te="FORBID_ATTR"in o?M({},o.FORBID_ATTR):{},Ut="USE_PROFILES"in o&&o.USE_PROFILES,$e=o.ALLOW_ARIA_ATTR!==!1,Ue=o.ALLOW_DATA_ATTR!==!1,rn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,ie=o.SAFE_FOR_TEMPLATES||!1,Yt=o.WHOLE_DOCUMENT||!1,se=o.RETURN_DOM||!1,Ie=o.RETURN_DOM_FRAGMENT||!1,ae=o.RETURN_TRUSTED_TYPE||!1,He=o.FORCE_BODY||!1,on=o.SANITIZE_DOM!==!1,qe=o.KEEP_CONTENT!==!1,ce=o.IN_PLACE||!1,nt=o.ALLOWED_URI_REGEXP||nt,Le=o.NAMESPACE||Jt,o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(lt.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(lt.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(lt.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),de=de=me.indexOf(o.PARSER_MEDIA_TYPE)===-1?ge:o.PARSER_MEDIA_TYPE,Gt=de==="application/xhtml+xml"?function(O){return O}:_t,ie&&(Ue=!1),Ie&&(se=!0),Ut&&(dt=M({},P(St)),mt=[],Ut.html===!0&&(M(dt,jt),M(mt,Et)),Ut.svg===!0&&(M(dt,wt),M(mt,Nt),M(mt,Lt)),Ut.svgFilters===!0&&(M(dt,It),M(mt,Nt),M(mt,Lt)),Ut.mathMl===!0&&(M(dt,ut),M(mt,Vt),M(mt,Lt))),o.ADD_TAGS&&(dt===nn&&(dt=J(dt)),M(dt,o.ADD_TAGS)),o.ADD_ATTR&&(mt===re&&(mt=J(mt)),M(mt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&M(Be,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(le===sn&&(le=J(le)),M(le,o.FORBID_CONTENTS)),qe&&(dt["#text"]=!0),Yt&&M(dt,["html","head","body"]),dt.table&&(M(dt,["tbody"]),delete oe.tbody),T&&T(o),fe=o)},fn=M({},["mi","mo","mn","ms","mtext"]),pn=M({},["foreignobject","desc","title","annotation-xml"]),Fn=M({},["title","style","font","a","script"]),zt=M({},wt);M(zt,It),M(zt,te);var Me=M({},ut);M(Me,ct);var Nn=function(o){var O=Pe(o);O&&O.tagName||(O={namespaceURI:Jt,tagName:"template"});var x=_t(o.tagName),rt=_t(O.tagName);return o.namespaceURI===We?O.namespaceURI===Jt?x==="svg":O.namespaceURI===ue?x==="svg"&&(rt==="annotation-xml"||fn[rt]):!!zt[x]:o.namespaceURI===ue?O.namespaceURI===Jt?x==="math":O.namespaceURI===We?x==="math"&&pn[rt]:!!Me[x]:o.namespaceURI===Jt&&!(O.namespaceURI===We&&!pn[rt])&&!(O.namespaceURI===ue&&!fn[rt])&&!Me[x]&&(Fn[x]||!zt[x])},Ht=function(o){pt(I.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Ye}catch{o.remove()}}},ye=function(o,O){try{pt(I.removed,{attribute:O.getAttributeNode(o),from:O})}catch{pt(I.removed,{attribute:null,from:O})}if(O.removeAttribute(o),o==="is"&&!mt[o])if(se||Ie)try{Ht(O)}catch{}else try{O.setAttribute(o,"")}catch{}},hn=function(o){var O,x;if(He)o="<remove></remove>"+o;else{var rt=xt(o,/^[\r\n\t ]+/);x=rt&&rt[0]}de==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var ft=$t?$t.createHTML(o):o;if(Le===Jt)try{O=new An().parseFromString(ft,de)}catch{}if(!O||!O.documentElement){O=Re.createDocument(Le,"template",null);try{O.documentElement.innerHTML=ln?"":ft}catch{}}var bt=O.body||O.documentElement;return o&&x&&bt.insertBefore(V.createTextNode(x),bt.childNodes[0]||null),Le===Jt?Xe.call(O,Yt?"html":"body")[0]:Yt?O.documentElement:bt},dn=function(o){return ne.call(o.ownerDocument||o,o,Ne.SHOW_ELEMENT|Ne.SHOW_COMMENT|Ne.SHOW_TEXT,null,!1)},Pn=function(o){return o instanceof On&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Kt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},ve=function(o){return u(Wt)==="object"?o instanceof Wt:o&&u(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},Ot=function(o,O,x){Mt[o]&&et(Mt[o],function(rt){rt.call(I,O,x,fe)})},be=function(o){var O;if(Ot("beforeSanitizeElements",o,null),Pn(o)||b(/[\u0080-\uFFFF]/,o.nodeName))return Ht(o),!0;var x=Gt(o.nodeName);if(Ot("uponSanitizeElement",o,{tagName:x,allowedTags:dt}),o.hasChildNodes()&&!ve(o.firstElementChild)&&(!ve(o.content)||!ve(o.content.firstElementChild))&&b(/<[/\w]/g,o.innerHTML)&&b(/<[/\w]/g,o.textContent)||x==="select"&&b(/<template/i,o.innerHTML))return Ht(o),!0;if(!dt[x]||oe[x]){if(!oe[x]&&Xt(x)&&(lt.tagNameCheck instanceof RegExp&&b(lt.tagNameCheck,x)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(x)))return!1;if(qe&&!le[x]){var rt=Pe(o)||o.parentNode,ft=Tn(o)||o.childNodes;if(ft&&rt)for(var bt=ft.length-1;bt>=0;--bt)rt.insertBefore(En(ft[bt],!0),kn(o))}return Ht(o),!0}return o instanceof ee&&!Nn(o)?(Ht(o),!0):x!=="noscript"&&x!=="noembed"||!b(/<\/no(script|embed)/i,o.innerHTML)?(ie&&o.nodeType===3&&(O=o.textContent,O=vt(O,je," "),O=vt(O,Ee," "),o.textContent!==O&&(pt(I.removed,{element:o.cloneNode()}),o.textContent=O)),Ot("afterSanitizeElements",o,null),!1):(Ht(o),!0)},mn=function(o,O,x){if(on&&(O==="id"||O==="name")&&(x in V||x in Mn))return!1;if(!(Ue&&!Te[O]&&b(De,O))){if(!($e&&b(Ln,O))){if(!mt[O]||Te[O]){if(!(Xt(o)&&(lt.tagNameCheck instanceof RegExp&&b(lt.tagNameCheck,o)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(o))&&(lt.attributeNameCheck instanceof RegExp&&b(lt.attributeNameCheck,O)||lt.attributeNameCheck instanceof Function&&lt.attributeNameCheck(O))||O==="is"&&lt.allowCustomizedBuiltInElements&&(lt.tagNameCheck instanceof RegExp&&b(lt.tagNameCheck,x)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(x))))return!1}else if(!Be[O]){if(!b(nt,vt(x,ke,""))){if((O!=="src"&&O!=="xlink:href"&&O!=="href"||o==="script"||Se(x,"data:")!==0||!an[o])&&!(rn&&!b(en,vt(x,ke,"")))){if(x)return!1}}}}}return!0},Xt=function(o){return o.indexOf("-")>0},_e=function(o){var O,x,rt,ft;Ot("beforeSanitizeAttributes",o,null);var bt=o.attributes;if(bt){var gt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:mt};for(ft=bt.length;ft--;){var we=O=bt[ft],Zt=we.name,Tt=we.namespaceURI;if(x=Zt==="value"?O.value:p(O.value),rt=Gt(Zt),gt.attrName=rt,gt.attrValue=x,gt.keepAttr=!0,gt.forceKeepAttr=void 0,Ot("uponSanitizeAttribute",o,gt),x=gt.attrValue,!gt.forceKeepAttr&&(ye(Zt,o),gt.keepAttr))if(b(/\/>/i,x))ye(Zt,o);else{ie&&(x=vt(x,je," "),x=vt(x,Ee," "));var Je=Gt(o.nodeName);if(mn(Je,rt,x))try{Tt?o.setAttributeNS(Tt,Zt,x):o.setAttribute(Zt,x),st(I.removed)}catch{}}}Ot("afterSanitizeAttributes",o,null)}},Rn=function o(O){var x,rt=dn(O);for(Ot("beforeSanitizeShadowDOM",O,null);x=rt.nextNode();)Ot("uponSanitizeShadowNode",x,null),be(x)||(x.content instanceof ht&&o(x.content),_e(x));Ot("afterSanitizeShadowDOM",O,null)};return I.sanitize=function(o,O){var x,rt,ft,bt,gt;if((ln=!o)&&(o="<!-->"),typeof o!="string"&&!ve(o)){if(typeof o.toString!="function")throw U("toString is not a function");if(typeof(o=o.toString())!="string")throw U("dirty is not a string, aborting")}if(!I.isSupported){if(u(C.toStaticHTML)==="object"||typeof C.toStaticHTML=="function"){if(typeof o=="string")return C.toStaticHTML(o);if(ve(o))return C.toStaticHTML(o.outerHTML)}return o}if(ze||Ge(O),I.removed=[],typeof o=="string"&&(ce=!1),ce){if(o.nodeName){var we=Gt(o.nodeName);if(!dt[we]||oe[we])throw U("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Wt)(rt=(x=hn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&rt.nodeName==="BODY"||rt.nodeName==="HTML"?x=rt:x.appendChild(rt);else{if(!se&&!ie&&!Yt&&o.indexOf("<")===-1)return $t&&ae?$t.createHTML(o):o;if(!(x=hn(o)))return se?null:ae?Ye:""}x&&He&&Ht(x.firstChild);for(var Zt=dn(ce?o:x);ft=Zt.nextNode();)ft.nodeType===3&&ft===bt||be(ft)||(ft.content instanceof ht&&Rn(ft.content),_e(ft),bt=ft);if(bt=null,ce)return o;if(se){if(Ie)for(gt=Qe.call(x.ownerDocument);x.firstChild;)gt.appendChild(x.firstChild);else gt=x;return mt.shadowroot&&(gt=In.call(H,gt,!0)),gt}var Tt=Yt?x.outerHTML:x.innerHTML;return Yt&&dt["!doctype"]&&x.ownerDocument&&x.ownerDocument.doctype&&x.ownerDocument.doctype.name&&b(Cn,x.ownerDocument.doctype.name)&&(Tt="<!DOCTYPE "+x.ownerDocument.doctype.name+`>
`+Tt),ie&&(Tt=vt(Tt,je," "),Tt=vt(Tt,Ee," ")),$t&&ae?$t.createHTML(Tt):Tt},I.setConfig=function(o){Ge(o),ze=!0},I.clearConfig=function(){fe=null,ze=!1},I.isValidAttribute=function(o,O,x){fe||Ge({});var rt=Gt(o),ft=Gt(O);return mn(rt,ft,x)},I.addHook=function(o,O){typeof O=="function"&&(Mt[o]=Mt[o]||[],pt(Mt[o],O))},I.removeHook=function(o){if(Mt[o])return st(Mt[o])},I.removeHooks=function(o){Mt[o]&&(Mt[o]=[])},I.removeAllHooks=function(){Mt={}},I}return Ve()}()},729:N=>{var u=Object.prototype.hasOwnProperty,j="~";function L(){}function A(h,_,f){this.fn=h,this.context=_,this.once=f||!1}function P(h,_,f,w,y){if(typeof f!="function")throw new TypeError("The listener must be a function");var k=new A(f,w||h,y),$=j?j+_:_;return h._events[$]?h._events[$].fn?h._events[$]=[h._events[$],k]:h._events[$].push(k):(h._events[$]=k,h._eventsCount++),h}function Y(h,_){--h._eventsCount==0?h._events=new L:delete h._events[_]}function v(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(j=!1)),v.prototype.eventNames=function(){var h,_,f=[];if(this._eventsCount===0)return f;for(_ in h=this._events)u.call(h,_)&&f.push(j?_.slice(1):_);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(h)):f},v.prototype.listeners=function(h){var _=j?j+h:h,f=this._events[_];if(!f)return[];if(f.fn)return[f.fn];for(var w=0,y=f.length,k=new Array(y);w<y;w++)k[w]=f[w].fn;return k},v.prototype.listenerCount=function(h){var _=j?j+h:h,f=this._events[_];return f?f.fn?1:f.length:0},v.prototype.emit=function(h,_,f,w,y,k){var $=j?j+h:h;if(!this._events[$])return!1;var E,T,i=this._events[$],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(h,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,_),!0;case 3:return i.fn.call(i.context,_,f),!0;case 4:return i.fn.call(i.context,_,f,w),!0;case 5:return i.fn.call(i.context,_,f,w,y),!0;case 6:return i.fn.call(i.context,_,f,w,y,k),!0}for(T=1,E=new Array(l-1);T<l;T++)E[T-1]=arguments[T];i.fn.apply(i.context,E)}else{var m,g=i.length;for(T=0;T<g;T++)switch(i[T].once&&this.removeListener(h,i[T].fn,void 0,!0),l){case 1:i[T].fn.call(i[T].context);break;case 2:i[T].fn.call(i[T].context,_);break;case 3:i[T].fn.call(i[T].context,_,f);break;case 4:i[T].fn.call(i[T].context,_,f,w);break;default:if(!E)for(m=1,E=new Array(l-1);m<l;m++)E[m-1]=arguments[m];i[T].fn.apply(i[T].context,E)}}return!0},v.prototype.on=function(h,_,f){return P(this,h,_,f,!1)},v.prototype.once=function(h,_,f){return P(this,h,_,f,!0)},v.prototype.removeListener=function(h,_,f,w){var y=j?j+h:h;if(!this._events[y])return this;if(!_)return Y(this,y),this;var k=this._events[y];if(k.fn)k.fn!==_||w&&!k.once||f&&k.context!==f||Y(this,y);else{for(var $=0,E=[],T=k.length;$<T;$++)(k[$].fn!==_||w&&!k[$].once||f&&k[$].context!==f)&&E.push(k[$]);E.length?this._events[y]=E.length===1?E[0]:E:Y(this,y)}return this},v.prototype.removeAllListeners=function(h){var _;return h?(_=j?j+h:h,this._events[_]&&Y(this,_)):(this._events=new L,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=j,v.EventEmitter=v,N.exports=v},717:N=>{typeof Object.create=="function"?N.exports=function(u,j){u.super_=j,u.prototype=Object.create(j.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}})}:N.exports=function(u,j){u.super_=j;var L=function(){};L.prototype=j.prototype,u.prototype=new L,u.prototype.constructor=u}},824:N=>{var u=1e3,j=60*u,L=60*j,A=24*L,P=7*A,Y=365.25*A;function v(h,_,f,w){var y=_>=1.5*f;return Math.round(h/f)+" "+w+(y?"s":"")}N.exports=function(h,_){_=_||{};var f=typeof h;if(f==="string"&&h.length>0)return function(w){if(!((w=String(w)).length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(w);if(y){var k=parseFloat(y[1]);switch((y[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return k*Y;case"weeks":case"week":case"w":return k*P;case"days":case"day":case"d":return k*A;case"hours":case"hour":case"hrs":case"hr":case"h":return k*L;case"minutes":case"minute":case"mins":case"min":case"m":return k*j;case"seconds":case"second":case"secs":case"sec":case"s":return k*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return k;default:return}}}}(h);if(f==="number"&&isFinite(h))return _.long?function(w){var y=Math.abs(w);return y>=A?v(w,y,A,"day"):y>=L?v(w,y,L,"hour"):y>=j?v(w,y,j,"minute"):y>=u?v(w,y,u,"second"):w+" ms"}(h):function(w){var y=Math.abs(w);return y>=A?Math.round(w/A)+"d":y>=L?Math.round(w/L)+"h":y>=j?Math.round(w/j)+"m":y>=u?Math.round(w/u)+"s":w+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},520:(N,u,j)=>{var L=j(155),A=L.platform==="win32",P=j(539);function Y(i,l){for(var m=[],g=0;g<i.length;g++){var W=i[g];W&&W!=="."&&(W===".."?m.length&&m[m.length-1]!==".."?m.pop():l&&m.push(".."):m.push(W))}return m}function v(i){for(var l=i.length-1,m=0;m<=l&&!i[m];m++);for(var g=l;g>=0&&!i[g];g--);return m===0&&g===l?i:m>g?[]:i.slice(m,g+1)}var h=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,_=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,f={};function w(i){var l=h.exec(i),m=(l[1]||"")+(l[2]||""),g=l[3]||"",W=_.exec(g);return[m,W[1],W[2],W[3]]}function y(i){var l=h.exec(i),m=l[1]||"",g=!!m&&m[1]!==":";return{device:m,isUnc:g,isAbsolute:g||!!l[2],tail:l[3]}}function k(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}f.resolve=function(){for(var i="",l="",m=!1,g=arguments.length-1;g>=-1;g--){var W;if(g>=0?W=arguments[g]:i?(W=L.env["="+i])&&W.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(W=i+"\\"):W=L.cwd(),!P.isString(W))throw new TypeError("Arguments to path.resolve must be strings");if(W){var et=y(W),st=et.device,pt=et.isUnc,_t=et.isAbsolute,xt=et.tail;if((!st||!i||st.toLowerCase()===i.toLowerCase())&&(i||(i=st),m||(l=xt+"\\"+l,m=_t),i&&m))break}}return pt&&(i=k(i)),i+(m?"\\":"")+(l=Y(l.split(/[\\\/]+/),!m).join("\\"))||"."},f.normalize=function(i){var l=y(i),m=l.device,g=l.isUnc,W=l.isAbsolute,et=l.tail,st=/[\\\/]$/.test(et);return(et=Y(et.split(/[\\\/]+/),!W).join("\\"))||W||(et="."),et&&st&&(et+="\\"),g&&(m=k(m)),m+(W?"\\":"")+et},f.isAbsolute=function(i){return y(i).isAbsolute},f.join=function(){for(var i=[],l=0;l<arguments.length;l++){var m=arguments[l];if(!P.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&i.push(m)}var g=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(g=g.replace(/^[\\\/]{2,}/,"\\")),f.normalize(g)},f.relative=function(i,l){i=f.resolve(i),l=f.resolve(l);for(var m=i.toLowerCase(),g=l.toLowerCase(),W=v(l.split("\\")),et=v(m.split("\\")),st=v(g.split("\\")),pt=Math.min(et.length,st.length),_t=pt,xt=0;xt<pt;xt++)if(et[xt]!==st[xt]){_t=xt;break}if(_t==0)return l;var vt=[];for(xt=_t;xt<et.length;xt++)vt.push("..");return(vt=vt.concat(W.slice(_t))).join("\\")},f._makeLong=function(i){if(!P.isString(i))return i;if(!i)return"";var l=f.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},f.dirname=function(i){var l=w(i),m=l[0],g=l[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},f.basename=function(i,l){var m=w(i)[2];return l&&m.substr(-1*l.length)===l&&(m=m.substr(0,m.length-l.length)),m},f.extname=function(i){return w(i)[3]},f.format=function(i){if(!P.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!P.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var m=i.dir,g=i.base||"";return m?m[m.length-1]===f.sep?m+g:m+f.sep+g:g},f.parse=function(i){if(!P.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=w(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},f.sep="\\",f.delimiter=";";var $=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,E={};function T(i){return $.exec(i).slice(1)}E.resolve=function(){for(var i="",l=!1,m=arguments.length-1;m>=-1&&!l;m--){var g=m>=0?arguments[m]:L.cwd();if(!P.isString(g))throw new TypeError("Arguments to path.resolve must be strings");g&&(i=g+"/"+i,l=g[0]==="/")}return(l?"/":"")+(i=Y(i.split("/"),!l).join("/"))||"."},E.normalize=function(i){var l=E.isAbsolute(i),m=i&&i[i.length-1]==="/";return(i=Y(i.split("/"),!l).join("/"))||l||(i="."),i&&m&&(i+="/"),(l?"/":"")+i},E.isAbsolute=function(i){return i.charAt(0)==="/"},E.join=function(){for(var i="",l=0;l<arguments.length;l++){var m=arguments[l];if(!P.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&(i+=i?"/"+m:m)}return E.normalize(i)},E.relative=function(i,l){i=E.resolve(i).substr(1),l=E.resolve(l).substr(1);for(var m=v(i.split("/")),g=v(l.split("/")),W=Math.min(m.length,g.length),et=W,st=0;st<W;st++)if(m[st]!==g[st]){et=st;break}var pt=[];for(st=et;st<m.length;st++)pt.push("..");return(pt=pt.concat(g.slice(et))).join("/")},E._makeLong=function(i){return i},E.dirname=function(i){var l=T(i),m=l[0],g=l[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},E.basename=function(i,l){var m=T(i)[2];return l&&m.substr(-1*l.length)===l&&(m=m.substr(0,m.length-l.length)),m},E.extname=function(i){return T(i)[3]},E.format=function(i){if(!P.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!P.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+E.sep:"")+(i.base||"")},E.parse=function(i){if(!P.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=T(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},E.sep="/",E.delimiter=":",N.exports=A?f:E,N.exports.posix=E,N.exports.win32=f},155:N=>{var u,j,L=N.exports={};function A(){throw new Error("setTimeout has not been defined")}function P(){throw new Error("clearTimeout has not been defined")}function Y(E){if(u===setTimeout)return setTimeout(E,0);if((u===A||!u)&&setTimeout)return u=setTimeout,setTimeout(E,0);try{return u(E,0)}catch{try{return u.call(null,E,0)}catch{return u.call(this,E,0)}}}(function(){try{u=typeof setTimeout=="function"?setTimeout:A}catch{u=A}try{j=typeof clearTimeout=="function"?clearTimeout:P}catch{j=P}})();var v,h=[],_=!1,f=-1;function w(){_&&v&&(_=!1,v.length?h=v.concat(h):f=-1,h.length&&y())}function y(){if(!_){var E=Y(w);_=!0;for(var T=h.length;T;){for(v=h,h=[];++f<T;)v&&v[f].run();f=-1,T=h.length}v=null,_=!1,function(i){if(j===clearTimeout)return clearTimeout(i);if((j===P||!j)&&clearTimeout)return j=clearTimeout,clearTimeout(i);try{j(i)}catch{try{return j.call(null,i)}catch{return j.call(this,i)}}}(E)}}function k(E,T){this.fun=E,this.array=T}function $(){}L.nextTick=function(E){var T=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)T[i-1]=arguments[i];h.push(new k(E,T)),h.length!==1||_||Y(y)},k.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=$,L.addListener=$,L.once=$,L.off=$,L.removeListener=$,L.removeAllListeners=$,L.emit=$,L.prependListener=$,L.prependOnceListener=$,L.listeners=function(E){return[]},L.binding=function(E){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(E){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},384:N=>{N.exports=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}},539:(N,u,j)=>{var L=j(155),A=/%[sdj%]/g;u.format=function(p){if(!i(p)){for(var b=[],U=0;U<arguments.length;U++)b.push(v(arguments[U]));return b.join(" ")}U=1;for(var tt=arguments,Ct=tt.length,M=String(p).replace(A,function(it){if(it==="%%")return"%";if(U>=Ct)return it;switch(it){case"%s":return String(tt[U++]);case"%d":return Number(tt[U++]);case"%j":try{return JSON.stringify(tt[U++])}catch{return"[Circular]"}default:return it}}),J=tt[U];U<Ct;J=tt[++U])E(J)||!g(J)?M+=" "+J:M+=" "+v(J);return M},u.deprecate=function(p,b){if(l(j.g.process))return function(){return u.deprecate(p,b).apply(this,arguments)};if(L.noDeprecation===!0)return p;var U=!1;return function(){if(!U){if(L.throwDeprecation)throw new Error(b);L.traceDeprecation?console.trace(b):console.error(b),U=!0}return p.apply(this,arguments)}};var P,Y={};function v(p,b){var U={seen:[],stylize:_};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),$(b)?U.showHidden=b:b&&u._extend(U,b),l(U.showHidden)&&(U.showHidden=!1),l(U.depth)&&(U.depth=2),l(U.colors)&&(U.colors=!1),l(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=h),f(U,p,U.depth)}function h(p,b){var U=v.styles[b];return U?"\x1B["+v.colors[U][0]+"m"+p+"\x1B["+v.colors[U][1]+"m":p}function _(p,b){return p}function f(p,b,U){if(p.customInspect&&b&&st(b.inspect)&&b.inspect!==u.inspect&&(!b.constructor||b.constructor.prototype!==b)){var tt=b.inspect(U,p);return i(tt)||(tt=f(p,tt,U)),tt}var Ct=function(ut,ct){if(l(ct))return ut.stylize("undefined","undefined");if(i(ct)){var St="'"+JSON.stringify(ct).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ut.stylize(St,"string")}if(T(ct))return ut.stylize(""+ct,"number");if($(ct))return ut.stylize(""+ct,"boolean");if(E(ct))return ut.stylize("null","null")}(p,b);if(Ct)return Ct;var M=Object.keys(b),J=function(ut){var ct={};return ut.forEach(function(St,Et){ct[St]=!0}),ct}(M);if(p.showHidden&&(M=Object.getOwnPropertyNames(b)),et(b)&&(M.indexOf("message")>=0||M.indexOf("description")>=0))return w(b);if(M.length===0){if(st(b)){var it=b.name?": "+b.name:"";return p.stylize("[Function"+it+"]","special")}if(m(b))return p.stylize(RegExp.prototype.toString.call(b),"regexp");if(W(b))return p.stylize(Date.prototype.toString.call(b),"date");if(et(b))return w(b)}var jt,wt="",It=!1,te=["{","}"];return k(b)&&(It=!0,te=["[","]"]),st(b)&&(wt=" [Function"+(b.name?": "+b.name:"")+"]"),m(b)&&(wt=" "+RegExp.prototype.toString.call(b)),W(b)&&(wt=" "+Date.prototype.toUTCString.call(b)),et(b)&&(wt=" "+w(b)),M.length!==0||It&&b.length!=0?U<0?m(b)?p.stylize(RegExp.prototype.toString.call(b),"regexp"):p.stylize("[Object]","special"):(p.seen.push(b),jt=It?function(ut,ct,St,Et,Nt){for(var Vt=[],Lt=0,kt=ct.length;Lt<kt;++Lt)Se(ct,String(Lt))?Vt.push(y(ut,ct,St,Et,String(Lt),!0)):Vt.push("");return Nt.forEach(function(pe){pe.match(/^\d+$/)||Vt.push(y(ut,ct,St,Et,pe,!0))}),Vt}(p,b,U,J,M):M.map(function(ut){return y(p,b,U,J,ut,It)}),p.seen.pop(),function(ut,ct,St){return ut.reduce(function(Et,Nt){return Nt.indexOf(`
`)>=0,Et+Nt.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?St[0]+(ct===""?"":ct+`
 `)+" "+ut.join(`,
  `)+" "+St[1]:St[0]+ct+" "+ut.join(", ")+" "+St[1]}(jt,wt,te)):te[0]+wt+te[1]}function w(p){return"["+Error.prototype.toString.call(p)+"]"}function y(p,b,U,tt,Ct,M){var J,it,jt;if((jt=Object.getOwnPropertyDescriptor(b,Ct)||{value:b[Ct]}).get?it=jt.set?p.stylize("[Getter/Setter]","special"):p.stylize("[Getter]","special"):jt.set&&(it=p.stylize("[Setter]","special")),Se(tt,Ct)||(J="["+Ct+"]"),it||(p.seen.indexOf(jt.value)<0?(it=E(U)?f(p,jt.value,null):f(p,jt.value,U-1)).indexOf(`
`)>-1&&(it=M?it.split(`
`).map(function(wt){return"  "+wt}).join(`
`).substr(2):`
`+it.split(`
`).map(function(wt){return"   "+wt}).join(`
`)):it=p.stylize("[Circular]","special")),l(J)){if(M&&Ct.match(/^\d+$/))return it;(J=JSON.stringify(""+Ct)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(J=J.substr(1,J.length-2),J=p.stylize(J,"name")):(J=J.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),J=p.stylize(J,"string"))}return J+": "+it}function k(p){return Array.isArray(p)}function $(p){return typeof p=="boolean"}function E(p){return p===null}function T(p){return typeof p=="number"}function i(p){return typeof p=="string"}function l(p){return p===void 0}function m(p){return g(p)&&pt(p)==="[object RegExp]"}function g(p){return typeof p=="object"&&p!==null}function W(p){return g(p)&&pt(p)==="[object Date]"}function et(p){return g(p)&&(pt(p)==="[object Error]"||p instanceof Error)}function st(p){return typeof p=="function"}function pt(p){return Object.prototype.toString.call(p)}function _t(p){return p<10?"0"+p.toString(10):p.toString(10)}u.debuglog=function(p){if(l(P)&&(P=L.env.NODE_DEBUG||""),p=p.toUpperCase(),!Y[p])if(new RegExp("\\b"+p+"\\b","i").test(P)){var b=L.pid;Y[p]=function(){var U=u.format.apply(u,arguments);console.error("%s %d: %s",p,b,U)}}else Y[p]=function(){};return Y[p]},u.inspect=v,v.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},v.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},u.isArray=k,u.isBoolean=$,u.isNull=E,u.isNullOrUndefined=function(p){return p==null},u.isNumber=T,u.isString=i,u.isSymbol=function(p){return typeof p=="symbol"},u.isUndefined=l,u.isRegExp=m,u.isObject=g,u.isDate=W,u.isError=et,u.isFunction=st,u.isPrimitive=function(p){return p===null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||typeof p=="symbol"||p===void 0},u.isBuffer=j(384);var xt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function vt(){var p=new Date,b=[_t(p.getHours()),_t(p.getMinutes()),_t(p.getSeconds())].join(":");return[p.getDate(),xt[p.getMonth()],b].join(" ")}function Se(p,b){return Object.prototype.hasOwnProperty.call(p,b)}u.log=function(){console.log("%s - %s",vt(),u.format.apply(u,arguments))},u.inherits=j(717),u._extend=function(p,b){if(!b||!g(b))return p;for(var U=Object.keys(b),tt=U.length;tt--;)p[U[tt]]=b[U[tt]];return p}}},Z={};function q(N){var u=Z[N];if(u!==void 0)return u.exports;var j=Z[N]={exports:{}};return At[N].call(j.exports,j,j.exports,q),j.exports}q.n=N=>{var u=N&&N.__esModule?()=>N.default:()=>N;return q.d(u,{a:u}),u},q.d=(N,u)=>{for(var j in u)q.o(u,j)&&!q.o(N,j)&&Object.defineProperty(N,j,{enumerable:!0,get:u[j]})},q.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),q.o=(N,u)=>Object.prototype.hasOwnProperty.call(N,u),q.r=N=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(N,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(N,"__esModule",{value:!0})};var Q={};return(()=>{q.r(Q),q.d(Q,{LSPluginUser:()=>Wn,setupPluginUserInstance:()=>yr});var N=q(520),u=(q(856),q(996)),j=q.n(u),L=function(){return L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},L.apply(this,arguments)};function A(e){return e.toLowerCase()}var P=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],Y=/[^A-Z0-9]+/gi;function v(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function h(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?P:s,c=r.stripRegexp,d=c===void 0?Y:c,S=r.transform,R=S===void 0?A:S,z=r.delimiter,F=z===void 0?" ":z,B=v(v(n,a,"$1\0$2"),d,"\0"),X=0,G=B.length;B.charAt(X)==="\0";)X++;for(;B.charAt(G-1)==="\0";)G--;return B.slice(X,G).split("\0").map(R).join(F)}(e,L({delimiter:"."},t))}var _=q(729),f=q.n(_);function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const y=navigator.platform.toLowerCase()==="win32"?N.win32:N.posix,k=function(e,t){return t===void 0&&(t={}),h(e,L({delimiter:"_"},t))};class $ extends f(){constructor(t,n){super(),w(this,"_tag",void 0),w(this,"_opts",void 0),w(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce((d,S)=>(S&&S instanceof Error?d+=`${S.message} ${S.stack}`:d+=S.toString(),d),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var c;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((c=console)===null||c===void 0||c[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function E(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=y.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return y.join(e,...t)}}function T(e,t){let n,r,s=!1;const a=d=>S=>{e&&clearTimeout(e),d(S),s=!0},c=new Promise((d,S)=>{n=a(d),r=a(S),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:d=>t=d,resolve:n,reject:r,promise:c,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var l=q(227),m=q.n(l);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const W="application/x-postmate-v1+json";let et=0;const st={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},pt=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===W&&!!st[e.data.postmate];class _t{constructor(t){g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"events",{}),g(this,"childOrigin",void 0),g(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!pt(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{const a=++et,c=d=>{d.data.uid===a&&d.data.postmate==="reply"&&(this.parent.removeEventListener("message",c,!1),d.data.error?s(d.data.error):r(d.data.value))};this.parent.addEventListener("message",c,!1),this.child.postMessage({postmate:"request",type:W,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:W,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class xt{constructor(t){g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),g(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!pt(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:c}=n.data;n.data.postmate!=="call"?((d,S,R)=>{const z=typeof d[S]=="function"?d[S].apply(null,R):d[S];return Promise.resolve(z)})(this.model,r,c).then(d=>{n.source.postMessage({property:r,postmate:"reply",type:W,uid:s,value:d},n.origin)}).catch(d=>{n.source.postMessage({property:r,postmate:"reply",type:W,uid:s,error:d},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:W,value:{name:t,data:n}},this.parentOrigin)}}class vt{constructor(t){g(this,"container",void 0),g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"childOrigin",void 0),g(this,"url",void 0),g(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(a=>{const c=document.createElement("a");c.href=a;const d=c.protocol.length>4?c.protocol:window.location.protocol,S=c.host.length?c.port==="80"||c.port==="443"?c.hostname:c.host:window.location.host;return c.origin||`${d}//${S}`})(t=t||this.url);let r,s=0;return new Promise((a,c)=>{const d=R=>!!pt(R,n)&&(R.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",d,!1),this.childOrigin=R.origin,a(new _t(this))):c("Failed handshake"));this.parent.addEventListener("message",d,!1);const S=()=>{s++,this.child.postMessage({postmate:"handshake",type:W,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{S(),r=setInterval(S,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}g(vt,"debug",!1),g(vt,"Model",void 0);class Se{constructor(t){g(this,"child",void 0),g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:W},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(c=>{this.model[c]=a[c]}),t(new xt(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:b,createSandboxContainer:U}=window.QSandbox||{};function tt(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class Ct extends f(){constructor(t){super(),p(this,"_pluginLocal",void 0),p(this,"_frame",void 0),p(this,"_root",void 0),p(this,"_loaded",!1),p(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await b(n,{fetch:tt});this._mount(r,document.body);const a=U(t,{elementGetter:()=>{var d;return(d=this._root)===null||d===void 0?void 0:d.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Wn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const c=await s(a,!0);this._unmountFns.push(c.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const J=m()("LSPlugin:caller"),it="#await#response#",jt="#lspmsg#",wt="#lspmsg#error#",It=e=>`#lspmsg#${e}`;class te extends f(){constructor(t){super(),M(this,"_pluginLocal",void 0),M(this,"_connected",!1),M(this,"_parent",void 0),M(this,"_child",void 0),M(this,"_shadow",void 0),M(this,"_status",void 0),M(this,"_userModel",{}),M(this,"_call",void 0),M(this,"_callUserModel",void 0),M(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,c=T(6e4),d=this._extendUserModel({"#lspmsg#ready#":async z=>{d[It(z?.pid)]=({type:F,payload:B})=>{J(`[host (_call) -> *user] ${this._debugTag}`,F,B),n.emit(F,B)},await c.resolve()},"#lspmsg#beforeunload#":async z=>{const F=T(1e4);n.emit("beforeunload",Object.assign({actor:F},z)),await F.promise},"#lspmsg#settings#":async({type:z,payload:F})=>{n.emit("settings:changed",F)},[jt]:async({ns:z,type:F,payload:B})=>{J(`[host (async) -> *user] ${this._debugTag} ns=${z} type=${F}`,B),z&&z.startsWith("hook")?n.emit(`${z}:${F}`,B):n.emit(F,B)},"#lspmsg#reply#":({_sync:z,result:F})=>{if(J(`[sync host -> *user] #${z}`,F),a.has(z)){const B=a.get(z);B&&(F!=null&&F.hasOwnProperty(wt)?B.reject(F[wt]):B.resolve(F),a.delete(z))}},...t});var S;if(r)return await c.promise,JSON.parse(JSON.stringify((S=this._pluginLocal)===null||S===void 0?void 0:S.toJSON()));const R=new Se(d).sendHandshakeReply();return this._status="pending",await R.then(z=>{this._child=z,this._connected=!0,this._call=async(F,B={},X)=>{if(X){const G=++s;a.set(G,X),B._sync=G,X.setTag(`async call #${G}`),J(`async call #${G}`)}return z.emit(It(d.baseInfo.id),{type:F,payload:B}),X?.promise},this._callUserModel=async(F,B)=>{try{d[F](B)}catch{J(`[model method] #${F} not existed`)}},setInterval(()=>{if(a.size>100)for(const[F,B]of a)B.settled&&a.delete(F)},18e5)}).finally(()=>{this._status=void 0}),await c.promise,d.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const s=T(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${it}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const c=document.createElement("div");c.classList.add("lsp-iframe-sandbox-container"),c.id=r,c.dataset.pid=n;try{var d;const F=(d=await this._pluginLocal._loadLayoutsData())===null||d===void 0?void 0:d.$$0;if(F){c.dataset.inited_layout="true";let{width:B,height:X,left:G,top:ot,vw:at,vh:yt}=F;G=Math.max(G,0),G=typeof at=="number"?`${Math.min(100*G/at,99)}%`:`${G}px`,ot=Math.max(ot,45),ot=typeof yt=="number"?`${Math.min(100*ot/yt,99)}%`:`${ot}px`,Object.assign(c.style,{width:B+"px",height:X+"px",left:G,top:ot})}}catch(F){console.error("[Restore Layout Error]",F)}document.body.appendChild(c);const S=new vt({id:n+"_iframe",container:c,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let R,z=S.sendHandshake();return this._status="pending",new Promise((F,B)=>{R=setTimeout(()=>{B(new Error("handshake Timeout")),S.destroy()},4e3),z.then(X=>{this._parent=X,this._connected=!0,this.emit("connected"),X.on(It(t.id),({type:G,payload:ot})=>{var at,yt;J("[user -> *host] ",G,ot),(at=this._pluginLocal)===null||at===void 0||at.emit(G,ot||{}),(yt=this._pluginLocal)===null||yt===void 0||yt.caller.emit(G,ot||{})}),this._call=async(...G)=>{await X.call(It(t.id),{type:G[0],payload:Object.assign(G[1]||{},{$$pid:t.id})})},this._callUserModel=async(G,...ot)=>{if(G.startsWith(it))return await X.get(G.replace(it,""),...ot);X.call(G,ot?.[0])},F(null)}).catch(X=>{B(X)}).finally(()=>{clearTimeout(R)})}).catch(F=>{throw J("[iframe sandbox] error",F),F}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new Ct(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var c;return a&&(s.actor=a),(c=this._pluginLocal)===null||c===void 0||c.emit(r,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(it)&&(a=a.replace(it,""));const c=r[1]||{},d=this._userModel[a];typeof d=="function"&&await d.call(null,c)}}catch(r){throw J("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ct{constructor(t,n){ut(this,"ctx",void 0),ut(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class St{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;const a=this.ensureHostScope();return t=(r=k(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Nt=e=>`task_callback_${e}`;class Vt{constructor(t,n,r={}){Et(this,"_client",void 0),Et(this,"_requestId",void 0),Et(this,"_requestOptions",void 0),Et(this,"_promise",void 0),Et(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((d,S)=>{if(!this._requestId)return S(null);this._client.once(Nt(this._requestId),R=>{R&&R instanceof Error?S(R):d(R)})});const{success:s,fail:a,final:c}=this._requestOptions;this._promise.then(d=>{s?.(d)}).catch(d=>{a?.(d)}).finally(()=>{c?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Lt extends _.EventEmitter{constructor(t){super(),Et(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(Nt(r),n?.payload)})}static createRequestTask(t,n,r){return new Vt(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...c}=t,d=this.ctx.Experiments.invokeExperMethod("request",n,c),S=Lt.createRequestTask(this.ctx.Request,d,t);return c.abortable?S:S.promise}get ctx(){return this._ctx}}const kt=Array.isArray,pe=typeof bn=="object"&&bn&&bn.Object===Object&&bn;var wn=typeof self=="object"&&self&&self.Object===Object&&self;const Pt=pe||wn||Function("return this")(),Bt=Pt.Symbol;var Ze=Object.prototype,xn=Ze.hasOwnProperty,Cn=Ze.toString,he=Bt?Bt.toStringTag:void 0;const Sn=function(e){var t=xn.call(e,he),n=e[he];try{e[he]=void 0;var r=!0}catch{}var s=Cn.call(e);return r&&(t?e[he]=n:delete e[he]),s};var Ve=Object.prototype.toString;const C=function(e){return Ve.call(e)};var I=Bt?Bt.toStringTag:void 0;const H=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":I&&I in Object(e)?Sn(e):C(e)},V=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ht=function(e){if(!V(e))return!1;var t=H(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Rt=Pt["__core-js_shared__"];var Wt,ee=(Wt=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+Wt:"";const Ne=function(e){return!!ee&&ee in e};var Ke=Function.prototype.toString;const Kt=function(e){if(e!=null){try{return Ke.call(e)}catch{}try{return e+""}catch{}}return""};var On=/^\[object .+?Constructor\]$/,An=Function.prototype,jn=Object.prototype,Oe=An.toString,En=jn.hasOwnProperty,kn=RegExp("^"+Oe.call(En).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Tn=function(e){return!(!V(e)||Ne(e))&&(ht(e)?kn:On).test(Kt(e))},Pe=function(e,t){return e?.[t]},Dt=function(e,t){var n=Pe(e,t);return Tn(n)?n:void 0},$t=function(){try{var e=Dt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ye=function(e,t,n){t=="__proto__"&&$t?$t(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ae=function(e){return function(t,n,r){for(var s=-1,a=Object(t),c=r(t),d=c.length;d--;){var S=c[++s];if(n(a[S],S,a)===!1)break}return t}}(),Re=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ne=function(e){return e!=null&&typeof e=="object"},Qe=function(e){return ne(e)&&H(e)=="[object Arguments]"};var Xe=Object.prototype,In=Xe.hasOwnProperty,tn=Xe.propertyIsEnumerable;const Mt=Qe(function(){return arguments}())?Qe:function(e){return ne(e)&&In.call(e,"callee")&&!tn.call(e,"callee")},de=function(){return!1};var Gt=D&&!D.nodeType&&D,je=Gt&&!0&&K&&!K.nodeType&&K,Ee=je&&je.exports===Gt?Pt.Buffer:void 0;const De=(Ee?Ee.isBuffer:void 0)||de;var Ln=/^(?:0|[1-9]\d*)$/;const en=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Ln.test(e))&&e>-1&&e%1==0&&e<t},ke=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var nt={};nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt["[object Arguments]"]=nt["[object Array]"]=nt["[object ArrayBuffer]"]=nt["[object Boolean]"]=nt["[object DataView]"]=nt["[object Date]"]=nt["[object Error]"]=nt["[object Function]"]=nt["[object Map]"]=nt["[object Number]"]=nt["[object Object]"]=nt["[object RegExp]"]=nt["[object Set]"]=nt["[object String]"]=nt["[object WeakMap]"]=!1;const dt=function(e){return ne(e)&&ke(e.length)&&!!nt[H(e)]},nn=function(e){return function(t){return e(t)}};var mt=D&&!D.nodeType&&D,re=mt&&!0&&K&&!K.nodeType&&K,lt=re&&re.exports===mt&&pe.process,oe=function(){try{var e=re&&re.require&&re.require("util").types;return e||lt&&lt.binding&&lt.binding("util")}catch{}}(),Te=oe&&oe.isTypedArray;const $e=Te?nn(Te):dt;var Ue=Object.prototype.hasOwnProperty;const rn=function(e,t){var n=kt(e),r=!n&&Mt(e),s=!n&&!r&&De(e),a=!n&&!r&&!s&&$e(e),c=n||r||s||a,d=c?Re(e.length,String):[],S=d.length;for(var R in e)!Ue.call(e,R)||c&&(R=="length"||s&&(R=="offset"||R=="parent")||a&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||en(R,S))||d.push(R);return d};var ie=Object.prototype;const Yt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||ie)},ze=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var He=Object.prototype.hasOwnProperty;const se=function(e){if(!Yt(e))return ze(e);var t=[];for(var n in Object(e))He.call(e,n)&&n!="constructor"&&t.push(n);return t},Ie=function(e){return e!=null&&ke(e.length)&&!ht(e)},ae=function(e){return Ie(e)?rn(e):se(e)},on=function(e,t){return e&&Ae(e,t,ae)},qe=function(){this.__data__=[],this.size=0},ce=function(e,t){return e===t||e!=e&&t!=t},Ut=function(e,t){for(var n=e.length;n--;)if(ce(e[n][0],t))return n;return-1};var le=Array.prototype.splice;const sn=function(e){var t=this.__data__,n=Ut(t,e);return!(n<0)&&(n==t.length-1?t.pop():le.call(t,n,1),--this.size,!0)},an=function(e){var t=this.__data__,n=Ut(t,e);return n<0?void 0:t[n][1]},cn=function(e){return Ut(this.__data__,e)>-1},Be=function(e,t){var n=this.__data__,r=Ut(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Qt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qt.prototype.clear=qe,Qt.prototype.delete=sn,Qt.prototype.get=an,Qt.prototype.has=cn,Qt.prototype.set=Be;const ue=Qt,We=function(){this.__data__=new ue,this.size=0},Jt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Le=function(e){return this.__data__.get(e)},ln=function(e){return this.__data__.has(e)},me=Dt(Pt,"Map"),ge=Dt(Object,"create"),fe=function(){this.__data__=ge?ge(null):{},this.size=0},Mn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var un=Object.prototype.hasOwnProperty;const Ge=function(e){var t=this.__data__;if(ge){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return un.call(t,e)?t[e]:void 0};var fn=Object.prototype.hasOwnProperty;const pn=function(e){var t=this.__data__;return ge?t[e]!==void 0:fn.call(t,e)},Fn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ge&&t===void 0?"__lodash_hash_undefined__":t,this};function zt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}zt.prototype.clear=fe,zt.prototype.delete=Mn,zt.prototype.get=Ge,zt.prototype.has=pn,zt.prototype.set=Fn;const Me=zt,Nn=function(){this.size=0,this.__data__={hash:new Me,map:new(me||ue),string:new Me}},Ht=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ye=function(e,t){var n=e.__data__;return Ht(t)?n[typeof t=="string"?"string":"hash"]:n.map},hn=function(e){var t=ye(this,e).delete(e);return this.size-=t?1:0,t},dn=function(e){return ye(this,e).get(e)},Pn=function(e){return ye(this,e).has(e)},ve=function(e,t){var n=ye(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Ot(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ot.prototype.clear=Nn,Ot.prototype.delete=hn,Ot.prototype.get=dn,Ot.prototype.has=Pn,Ot.prototype.set=ve;const be=Ot,mn=function(e,t){var n=this.__data__;if(n instanceof ue){var r=n.__data__;if(!me||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new be(r)}return n.set(e,t),this.size=n.size,this};function Xt(e){var t=this.__data__=new ue(e);this.size=t.size}Xt.prototype.clear=We,Xt.prototype.delete=Jt,Xt.prototype.get=Le,Xt.prototype.has=ln,Xt.prototype.set=mn;const _e=Xt,Rn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function O(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new be;++t<n;)this.add(e[t])}O.prototype.add=O.prototype.push=Rn,O.prototype.has=o;const x=O,rt=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},ft=function(e,t){return e.has(t)},bt=function(e,t,n,r,s,a){var c=1&n,d=e.length,S=t.length;if(d!=S&&!(c&&S>d))return!1;var R=a.get(e),z=a.get(t);if(R&&z)return R==t&&z==e;var F=-1,B=!0,X=2&n?new x:void 0;for(a.set(e,t),a.set(t,e);++F<d;){var G=e[F],ot=t[F];if(r)var at=c?r(ot,G,F,t,e,a):r(G,ot,F,e,t,a);if(at!==void 0){if(at)continue;B=!1;break}if(X){if(!rt(t,function(yt,Ft){if(!ft(X,Ft)&&(G===yt||s(G,yt,n,r,a)))return X.push(Ft)})){B=!1;break}}else if(G!==ot&&!s(G,ot,n,r,a)){B=!1;break}}return a.delete(e),a.delete(t),B},gt=Pt.Uint8Array,we=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Zt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var Tt=Bt?Bt.prototype:void 0,Je=Tt?Tt.valueOf:void 0;const Jn=function(e,t,n,r,s,a,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new gt(e),new gt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var d=we;case"[object Set]":var S=1&r;if(d||(d=Zt),e.size!=t.size&&!S)return!1;var R=c.get(e);if(R)return R==t;r|=2,c.set(e,t);var z=bt(d(e),d(t),r,s,a,c);return c.delete(e),z;case"[object Symbol]":if(Je)return Je.call(e)==Je.call(t)}return!1},br=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},_r=function(e,t,n){var r=t(e);return kt(e)?r:br(r,n(e))},wr=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var c=e[n];t(c,n,e)&&(a[s++]=c)}return a},xr=function(){return[]};var Cr=Object.prototype.propertyIsEnumerable,Zn=Object.getOwnPropertySymbols;const Sr=Zn?function(e){return e==null?[]:(e=Object(e),wr(Zn(e),function(t){return Cr.call(e,t)}))}:xr,Vn=function(e){return _r(e,ae,Sr)};var Or=Object.prototype.hasOwnProperty;const Ar=function(e,t,n,r,s,a){var c=1&n,d=Vn(e),S=d.length;if(S!=Vn(t).length&&!c)return!1;for(var R=S;R--;){var z=d[R];if(!(c?z in t:Or.call(t,z)))return!1}var F=a.get(e),B=a.get(t);if(F&&B)return F==t&&B==e;var X=!0;a.set(e,t),a.set(t,e);for(var G=c;++R<S;){var ot=e[z=d[R]],at=t[z];if(r)var yt=c?r(at,ot,z,t,e,a):r(ot,at,z,e,t,a);if(!(yt===void 0?ot===at||s(ot,at,n,r,a):yt)){X=!1;break}G||(G=z=="constructor")}if(X&&!G){var Ft=e.constructor,Ce=t.constructor;Ft==Ce||!("constructor"in e)||!("constructor"in t)||typeof Ft=="function"&&Ft instanceof Ft&&typeof Ce=="function"&&Ce instanceof Ce||(X=!1)}return a.delete(e),a.delete(t),X},Dn=Dt(Pt,"DataView"),$n=Dt(Pt,"Promise"),Un=Dt(Pt,"Set"),zn=Dt(Pt,"WeakMap");var Kn="[object Map]",Yn="[object Promise]",Qn="[object Set]",Xn="[object WeakMap]",tr="[object DataView]",jr=Kt(Dn),Er=Kt(me),kr=Kt($n),Tr=Kt(Un),Ir=Kt(zn),xe=H;(Dn&&xe(new Dn(new ArrayBuffer(1)))!=tr||me&&xe(new me)!=Kn||$n&&xe($n.resolve())!=Yn||Un&&xe(new Un)!=Qn||zn&&xe(new zn)!=Xn)&&(xe=function(e){var t=H(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Kt(n):"";if(r)switch(r){case jr:return tr;case Er:return Kn;case kr:return Yn;case Tr:return Qn;case Ir:return Xn}return t});const er=xe;var nr="[object Arguments]",rr="[object Array]",gn="[object Object]",or=Object.prototype.hasOwnProperty;const Lr=function(e,t,n,r,s,a){var c=kt(e),d=kt(t),S=c?rr:er(e),R=d?rr:er(t),z=(S=S==nr?gn:S)==gn,F=(R=R==nr?gn:R)==gn,B=S==R;if(B&&De(e)){if(!De(t))return!1;c=!0,z=!1}if(B&&!z)return a||(a=new _e),c||$e(e)?bt(e,t,n,r,s,a):Jn(e,t,S,n,r,s,a);if(!(1&n)){var X=z&&or.call(e,"__wrapped__"),G=F&&or.call(t,"__wrapped__");if(X||G){var ot=X?e.value():e,at=G?t.value():t;return a||(a=new _e),s(ot,at,n,r,a)}}return!!B&&(a||(a=new _e),Ar(e,t,n,r,s,a))},ir=function e(t,n,r,s,a){return t===n||(t==null||n==null||!ne(t)&&!ne(n)?t!=t&&n!=n:Lr(t,n,r,s,e,a))},Mr=function(e,t,n,r){var s=n.length,a=s;if(e==null)return!a;for(e=Object(e);s--;){var c=n[s];if(c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<a;){var d=(c=n[s])[0],S=e[d],R=c[1];if(c[2]){if(S===void 0&&!(d in e))return!1}else{var z=new _e,F;if(!(F===void 0?ir(R,S,3,r,z):F))return!1}}return!0},sr=function(e){return e==e&&!V(e)},Fr=function(e){for(var t=ae(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,sr(s)]}return t},ar=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},Nr=function(e){var t=Fr(e);return t.length==1&&t[0][2]?ar(t[0][0],t[0][1]):function(n){return n===e||Mr(n,e,t)}},Hn=function(e){return typeof e=="symbol"||ne(e)&&H(e)=="[object Symbol]"};var Pr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Rr=/^\w*$/;const qn=function(e,t){if(kt(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Hn(e))||Rr.test(e)||!Pr.test(e)||t!=null&&e in Object(t)};function Bn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var c=e.apply(this,r);return n.cache=a.set(s,c)||a,c};return n.cache=new(Bn.Cache||be),n}Bn.Cache=be;const Dr=Bn;var $r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ur=/\\(\\)?/g;const zr=function(e){var t=Dr(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace($r,function(n,r,s,a){t.push(s?a.replace(Ur,"$1"):r||n)}),t}),Hr=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var cr=Bt?Bt.prototype:void 0,lr=cr?cr.toString:void 0;const qr=function e(t){if(typeof t=="string")return t;if(kt(t))return Hr(t,e)+"";if(Hn(t))return lr?lr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Br=function(e){return e==null?"":qr(e)},ur=function(e,t){return kt(e)?e:qn(e,t)?[e]:zr(Br(e))},yn=function(e){if(typeof e=="string"||Hn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},fr=function(e,t){for(var n=0,r=(t=ur(t,e)).length;e!=null&&n<r;)e=e[yn(t[n++])];return n&&n==r?e:void 0},Wr=function(e,t,n){var r=e==null?void 0:fr(e,t);return r===void 0?n:r},Gr=function(e,t){return e!=null&&t in Object(e)},Jr=function(e,t,n){for(var r=-1,s=(t=ur(t,e)).length,a=!1;++r<s;){var c=yn(t[r]);if(!(a=e!=null&&n(e,c)))break;e=e[c]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&ke(s)&&en(c,s)&&(kt(e)||Mt(e))},Zr=function(e,t){return e!=null&&Jr(e,t,Gr)},Vr=function(e,t){return qn(e)&&sr(t)?ar(yn(e),t):function(n){var r=Wr(n,e);return r===void 0&&r===t?Zr(n,e):ir(t,r,3)}},Kr=function(e){return e},Yr=function(e){return function(t){return t?.[e]}},Qr=function(e){return function(t){return fr(t,e)}},Xr=function(e){return qn(e)?Yr(yn(e)):Qr(e)},to=function(e){return typeof e=="function"?e:e==null?Kr:typeof e=="object"?kt(e)?Vr(e[0],e[1]):Nr(e):Xr(e)},eo=function(e,t){var n={};return t=to(t),on(e,function(r,s,a){Ye(n,t(r,s,a),r)}),n};function pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class no{constructor(t,n){pr(this,"ctx",void 0),pr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(kt(r?.blocks)&&(r.blocks=r.blocks.map(s=>s&&eo(s,(a,c)=>`block/${c}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{const a=(c=>`service:search:${c}:${n.name}`)(r);t.caller.on(a,async c=>{if(ht(n?.[s.f])){let d=null;try{d=await n[s.f].apply(n,(s.args||[]).map(S=>{if(c){if(S===!0)return c;if(c.hasOwnProperty(S)){const R=c[S];return delete c[S],R}}})),s.transformOutput&&(d=s.transformOutput(d))}catch(S){console.error("[SearchService] ",S),d=S}finally{s.reply&&t.caller.call(`${a}:reply`,d)}}})})}}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ro=Symbol.for("proxy-continue"),oo=m()("LSPlugin:user"),hr=new $("",{console:!0});function Fe(e,t,n){var r;const{key:s,label:a,desc:c,palette:d,keybinding:S,extras:R}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const z=function(B){if(typeof B=="string")return B.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!z)return this.logger.error(`${a}: command key is required.`),!1;const F=`SimpleCommandHook${z}${++gr}`;this.Editor["on"+F](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:z,label:a,type:e,desc:c,keybinding:S,extras:R},["editor/hook",F]],d]})}function dr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(hr.error(`#${e} is not a valid UUID string.`),!1);var t}let vn=null,mr=new Map;const io={async getInfo(e){return vn||(vn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?vn[e]:vn},registerCommand:Fe,registerSearchService(e){if(mr.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);mr.set(e.name,new no(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:s}=e;return Fe.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,s="$shortcut$",a=n.key||s+k(r?.toString());return Fe.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;Fe.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:editor:${k(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let gr=0;const so={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;oo("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[s,...a]=r;if(s==="editor/hook"){let c=a[0],d=()=>{var R;(R=this.caller)===null||R===void 0||R.callUserModel(c)};typeof c=="function"&&(d=c);const S=`SlashCommandHook${s}${++gr}`;r[1]=S,this.Editor["on"+S](d)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Fe.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Fe.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},ao={onBlockChanged(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:db:${k(`block:${e}`)}`,s=({block:a,txData:c,txMeta:d})=>{a.uuid===e&&t(a,c,d)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},co={},lo={},uo={makeSandboxStorage(){return new ct(this,{assets:!0})}};class Wn extends f(){constructor(t,n){super(),qt(this,"_baseInfo",void 0),qt(this,"_caller",void 0),qt(this,"_version","0.0.17"),qt(this,"_debugTag",""),qt(this,"_settingsSchema",void 0),qt(this,"_connected",!1),qt(this,"_ui",new Map),qt(this,"_mFileStorage",void 0),qt(this,"_mRequest",void 0),qt(this,"_mExperiments",void 0),qt(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{const{actor:s,...a}=r,c=this._beforeunloadCallback;try{c&&await c(a),s?.resolve(null)}catch(d){this.logger.error("[beforeunload] ",d),s?.reject(d)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let c=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=c,c=j()(r,s,{arrayMerge:(d,S)=>S}),this._baseInfo=c,(a=c)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${c.id} [${c.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(c.settings=function(d,S){const R=(S||[]).reduce((z,F)=>("default"in F&&(z[F.key]=F.default),z),{});return Object.assign(R,d)}(c.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(d){console.warn(d)}n&&n.call(this,c)}catch(c){console.error(`${this._debugTag} [Ready Error]`,c)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return hr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),E(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,s=this.caller;return new Proxy(t,{get(a,c,d){const S=a[c];return function(...R){if(S){const F=S.apply(r,R.concat(n));if(F!==ro)return F}if(n){const F=c.toString().match(/^(once|off|on)/i);if(F!=null){const B=F[0].toLowerCase(),X=F.input,G=B==="off",ot=r.baseInfo.id;let at=X.slice(B.length),yt=R[0],Ft=R[1];typeof yt=="string"&&typeof Ft=="function"&&(yt=yt.replace(/^logseq./,":"),at=`${at}${yt}`,yt=Ft,Ft=R[2]),at=`hook:${n}:${k(at)}`,s[B](at,yt);const Ce=()=>{s.off(at,yt),s.listenerCount(at)||r.App._uninstallPluginHook(ot,at)};return G?void Ce():(r.App._installPluginHook(ot,at,Ft),Ce)}}let z=c;return["git","ui","assets"].includes(n)&&(z=n+"_"+z),s.callAsync("api:call",{tag:n,method:z,args:R})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(io,"app")}get Editor(){return this._makeUserProxy(so,"editor")}get DB(){return this._makeUserProxy(ao,"db")}get Git(){return this._makeUserProxy(co,"git")}get UI(){return this._makeUserProxy(lo,"ui")}get Assets(){return this._makeUserProxy(uo,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new ct(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Lt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new St(this)),t}}function yr(e,t){return new Wn(e,t)}if(window.__LSP__HOST__==null){const e=new te(null);window.logseq=yr({},e)}})(),Q})())})(_n,_n.exports);_n.exports;function fo(K){return K.trimStart().startsWith("```")}function po(K){return/^[a-zA-Z][a-zA-Z0-9_-]*::/.test(K.trim())}function ho(K){const D=K.trim();return D.startsWith("```")||D.startsWith("|")||D==="---"||D.startsWith("    ")}function mo(K){return K.split(`
`).filter(Z=>Z.includes("|")&&Z.trim().startsWith("|")).length>=2}function go(K){let D=K;return D=D.replace(/\{\{embed\s+\[\[[^\]]+\]\]\}\}/g,""),D=D.replace(/\{\{embed\s+\(\([^)]+\)\)\}\}/g,""),D=D.replace(/\{\{[^}]+\}\}/g,""),D=D.replace(/\[\[([^\]]+)\]\]/g,"$1"),D=D.replace(/\(\([^)]+\)\)/g,""),D=D.replace(/#\[\[[^\]]+\]\]/g,""),D=D.replace(/#[a-zA-Z0-9_-]+/g,""),D=D.replace(/[^\S\n]+/g," "),D=D.split(`
`).map(At=>At.trimEnd()).join(`
`),D=D.replace(/\n{3,}/g,`

`),D=D.trim(),D}function Gn(K,D,At){const Z=[],q=K.content||"";if(!q.trim())return Z;if(D===0&&At&&po(q)){if(K.children&&K.children.length>0)for(const Q of K.children)typeof Q=="object"&&Q!==null&&Z.push(...Gn(Q,D+1,!1));return Z}if(fo(q)){if(D===0)Z.push(q),Z.push("");else{const Q="  ".repeat(D-1),N=q.split(`
`);Z.push(`${Q}- ${N[0]}`);for(let u=1;u<N.length;u++)Z.push(`${Q}  ${N[u]}`)}return Z}if(ho(q)||mo(q))if(D===0)Z.push(q),Z.push("");else{const Q="  ".repeat(D-1),N=q.split(`
`);Z.push(`${Q}- ${N[0]}`);for(let u=1;u<N.length;u++)Z.push(`${Q}  ${N[u]}`)}else{const Q=go(q);if(Q)if(D===0)Z.push(Q),Z.push("");else{const N="  ".repeat(D-1),u=Q.split(`
`);Z.push(`${N}- ${u[0]}`);for(let j=1;j<u.length;j++)Z.push(`${N}  ${u[j]}`)}}if(K.children&&K.children.length>0){for(const Q of K.children)typeof Q=="object"&&Q!==null&&Z.push(...Gn(Q,D+1,!1));D===0&&Z.length>0&&Z[Z.length-1]!==""&&Z.push("")}return Z}function yo(K){const D=[];for(let Z=0;Z<K.length;Z++){const q=K[Z],N=Gn(q,0,Z===0);D.push(...N)}let At=D.join(`
`);return At=At.replace(/\n{3,}/g,`

`),At=At.trim(),At}async function vr(){try{const K=await logseq.Editor.getCurrentPageBlocksTree();if(!K||K.length===0){logseq.UI.showMsg("No content found on this page","warning");return}const D=yo(K);if(!D){logseq.UI.showMsg("No content to copy","warning");return}await parent.navigator.clipboard.writeText(D),logseq.UI.showMsg("Copied clean markdown to clipboard!","success")}catch(K){console.error("Failed to copy clean markdown:",K),logseq.UI.showMsg("Failed to copy: "+K.message,"error")}}async function vo(){logseq.Editor.registerSlashCommand("clean-markdown",async()=>{await vr()}),logseq.App.registerPageMenuItem("Copy as Clean Markdown",async()=>{await vr()}),console.log("Rip Bullet Points plugin loaded")}logseq.ready(vo).catch(console.error);
